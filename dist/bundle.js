(()=>{"use strict";function n(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,o,t,i,l,a,r,s,u,d;return{id:(null===(o=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===o?void 0:o.stringValue)||"",name:(null===(i=null===(t=n.fields)||void 0===t?void 0:t.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(a=null===(l=n.fields)||void 0===l?void 0:l.logoURL)||void 0===a?void 0:a.stringValue)||"",mainColor:(null===(s=null===(r=n.fields)||void 0===r?void 0:r.mainColor)||void 0===s?void 0:s.stringValue)||"",secondColor:(null===(d=null===(u=n.fields)||void 0===u?void 0:u.secondColor)||void 0===d?void 0:d.stringValue)||""}})):[]}var e=function(n,e,o,t){return new(o||(o=Promise))((function(i,l){function a(n){try{s(t.next(n))}catch(n){l(n)}}function r(n){try{s(t.throw(n))}catch(n){l(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof o?e:new o((function(n){n(e)}))).then(a,r)}s((t=t.apply(n,e||[])).next())}))},o=function(n,e,o,t){return new(o||(o=Promise))((function(i,l){function a(n){try{s(t.next(n))}catch(n){l(n)}}function r(n){try{s(t.throw(n))}catch(n){l(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof o?e:new o((function(n){n(e)}))).then(a,r)}s((t=t.apply(n,e||[])).next())}))};let t,i,l,a;function r(n,e,o,r){t=n,i=e,l=o,a=r}function s(n){return Object.assign({},n)}function u(n,e){const o=d(n);return 0==o?t.find((e=>e.name===n))[e]:1==o?i.find((e=>e.name===n))[e]:""}function d(n){const e=t.some((e=>e.name===n)),o=i.some((e=>e.name===n));return e?0:o?1:-1}function c(n){const e=t.find((e=>e.name===n));if(e)return e.logoUrl;const o=i.find((e=>e.name===n));return o?o.logoUrl:""}function f(n,e,o){let t="";const i=l.find((e=>e.name===n));return t=e?0===o?i.clubOwnerURL:i.unionOwnerURL:0===o?i.clubGuestURL:i.unionGuestURL,t}var m=function(n,e,o,t){return new(o||(o=Promise))((function(i,l){function a(n){try{s(t.next(n))}catch(n){l(n)}}function r(n){try{s(t.throw(n))}catch(n){l(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof o?e:new o((function(n){n(e)}))).then(a,r)}s((t=t.apply(n,e||[])).next())}))};function v(n,t){let i=function(n){let e=[];const o=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"RECTANGLE"===n.type));for(const n of o){const o={x:n.x,y:n.y,name:n.name};e.push(o)}return e}();const l=n.map(((n,l)=>m(this,void 0,void 0,(function*(){const r=function(n){const e=function(n){const e={},o={},t={};for(const i in n){const l=i.toLowerCase();l.includes("owner")?e[i]=n[i]:l.includes("quest")?o[i]=n[i]:t[i]=n[i]}return Object.assign({owner:e,quest:o},t)}(n),o={title:()=>s({name:"title",textContent:e.title}),date:()=>s({name:"date",textContent:e.date}),eventCaption:()=>s({name:"eventCaption",textContent:e.eventCaption}),event:()=>{return s({name:"event",imageUrl:(n=e.event,a.find((e=>e.name===n)).logoUrl)});var n},owner:()=>[s({name:"logoOwner",imageUrl:c(e.owner.logoOwner)}),s({name:"playerOwner",imageUrl:f(e.owner.playerOwner,!0,d(e.owner.logoOwner))}),s({name:"OwnerMainColor",textContent:u(e.owner.logoOwner,"mainColor")}),s({name:"OwnerSecondColor",textContent:u(e.owner.logoOwner,"secondColor")})],quest:()=>[s({name:"logoQuest",imageUrl:c(e.quest.logoQuest)}),s({name:"playerQuest",imageUrl:f(e.quest.playerQuest,!1,d(e.quest.logoQuest))}),s({name:"QuestMainColor",textContent:u(e.quest.logoQuest,"mainColor")}),s({name:"QuestSecondColor",textContent:u(e.quest.logoQuest,"secondColor")})],logoCaptionLeft:()=>s({name:"logoCaptionLeft",textContent:e.logoCaptionLeft}),logoCaptionRight:()=>s({name:"logoCaptionRight",textContent:e.logoCaptionRight})},t=[];for(const n in e){const e=o[n];if(e){const n=e();t.push(...Array.isArray(n)?n:[n])}}return t}(n);let m=function(n,e){let o=[];for(const t of n){const n=t.name;let i=e.find((e=>e.name===n));i&&(t.imageUrl=i.imageUrl,o.push(t))}const t=e.find((n=>"title"===n.name)),i=e.find((n=>"date"===n.name)),l=e.find((n=>"logoCaptionLeft"===n.name)),a=e.find((n=>"logoCaptionRight"===n.name)),r=e.find((n=>"eventCaption"===n.name)),s=e.find((n=>"OwnerMainColor"===n.name)),u=e.find((n=>"OwnerSecondColor"===n.name)),d=e.find((n=>"QuestMainColor"===n.name)),c=e.find((n=>"QuestSecondColor"===n.name));return t&&o.push(t),i&&o.push(i),l&&o.push(l),a&&o.push(a),r&&o.push(r),s&&o.push(s),u&&o.push(u),d&&o.push(d),c&&o.push(c),o}(i,r);yield function(n,t){return o(this,void 0,void 0,(function*(){return new Promise(((i,l)=>o(this,void 0,void 0,(function*(){const o=n.filter((n=>"title"!==n.name)),a=figma.createFrame();a.resize(1920,1080),a.x=0,a.y=t,a.name="TestBanner"+Date.now(),function(n){let e=[];const o=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"VECTOR"===n.type));for(const n of o){const o=n;e.push(o.clone())}return e}().map((e=>{if("Background"!==e.name){const o=n.find((n=>n.name===e.name)),t=function(n){const e=parseInt(n.slice(1),16);return{r:(e>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}}("#"+(null==o?void 0:o.textContent));e.fills=[{type:"SOLID",color:t}]}a.appendChild(e)}));try{const t=o.filter((n=>"string"==typeof n.imageUrl)).map((n=>{const e=n.imageUrl;return figma.createImageAsync(e)})),l=yield Promise.all(t);for(let n=0;n<l.length;n++){const e=l[n],t=o[n],i=figma.createRectangle(),{width:r,height:s}=yield e.getSizeAsync();i.resize(r,s),i.x=t.x||0,i.y=t.y||0,i.name=t.name||"",i.fills=[{type:"IMAGE",imageHash:e.hash,scaleMode:"FILL"}],a.appendChild(i)}const r={title:"title",date:"date",logoCaptionLeft:"logoCaptionLeft",logoCaptionRight:"logoCaptionRight",eventCaption:"eventCaption"},s=function(n){let e=[];const o=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"TEXT"===n.type));for(const n of o){const o=n;e.push(o.clone())}return e}(),u=function(n){let e=[];const o=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"FRAME"===n.type));for(const n of o){const o=n;e.push(o.clone())}return e}();yield function(n){return e(this,void 0,void 0,(function*(){try{for(const e of n)yield figma.loadFontAsync(e)}catch(n){console.error("Ошибка при загрузке шрифтов:",n)}}))}(s.map((n=>n.fontName))),u.map((n=>{a.appendChild(n)})),s.map((e=>{var o;const t=r[e.name]?null===(o=n.find((n=>n.name===r[e.name])))||void 0===o?void 0:o.textContent:"";e.characters=t||"",u.find((n=>{n.name===e.name?(n.appendChild(e),e.x=(n.width-e.width)/2,e.y=(n.height-e.height)/2):a.appendChild(e)}))})),i()}catch(n){console.error(n),l(n)}}))))}))}(m,t[l])}))));Promise.all(l).then((()=>m(this,void 0,void 0,(function*(){figma.closePlugin()})))).catch((n=>{console.log(n),figma.closePlugin()}))}figma.showUI(__html__),figma.ui.onmessage=e=>{if("importCSV"===e.type){const o=function(n){let e=[];const o=n.trim().split("\n");if(0===o.length)return void console.log("File is empty");let t=o[0].split(",");t=t.map((n=>n.trim()));for(let n=1;n<o.length;n++){let i=o[n].split(","),l={};for(let n=0;n<t.length;n++){const e=t[n],o=i[n].trim();l[e]=o}e.push(l)}return e}(e.data);figma.ui.close(),function(e){const t=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/players").then((n=>n.json())),i=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/clubs").then((n=>n.json())),l=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/unions").then((n=>n.json())),a=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/events").then((n=>n.json()));Promise.all([t,i,l,a]).then((([e,t,i,l])=>{(e=>{let t=n(e.clubs),i=n(e.unions),l=function(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,o,t,i,l,a,r,s,u,d,c,f,m,v;return{id:(null===(o=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===o?void 0:o.stringValue)||"",name:(null===(i=null===(t=n.fields)||void 0===t?void 0:t.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(a=null===(l=n.fields)||void 0===l?void 0:l.logoURL)||void 0===a?void 0:a.stringValue)||"",clubGuestURL:(null===(s=null===(r=n.fields)||void 0===r?void 0:r.clubGuestURL)||void 0===s?void 0:s.stringValue)||"",clubOwnerURL:(null===(d=null===(u=n.fields)||void 0===u?void 0:u.clubOwnerURL)||void 0===d?void 0:d.stringValue)||"",unionGuestURL:(null===(f=null===(c=n.fields)||void 0===c?void 0:c.unionGuestURL)||void 0===f?void 0:f.stringValue)||"",unionOwnerURL:(null===(v=null===(m=n.fields)||void 0===m?void 0:m.unionOwnerURL)||void 0===v?void 0:v.stringValue)||""}})):[]}(e.players),a=function(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,o,t,i,l,a;return{id:(null===(o=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===o?void 0:o.stringValue)||"",name:(null===(i=null===(t=n.fields)||void 0===t?void 0:t.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(a=null===(l=n.fields)||void 0===l?void 0:l.logoURL)||void 0===a?void 0:a.stringValue)||""}})):[]}(e.events);if(t&&l&&i&&a&&r(t,i,l,a),o){const n=(s=o.length,u=50,d=1080,Array.from({length:s},((n,e)=>(d+u)*e)));v(o,n)}var s,u,d})({players:e,clubs:t,unions:i,events:l})})).catch((n=>{console.error(n)}))}()}}})();