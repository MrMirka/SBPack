(()=>{"use strict";function n(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,t,o,i,a,l;return{id:(null===(t=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===t?void 0:t.stringValue)||"",name:(null===(i=null===(o=n.fields)||void 0===o?void 0:o.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(l=null===(a=n.fields)||void 0===a?void 0:a.logoURL)||void 0===l?void 0:l.stringValue)||""}})):[]}var e=function(n,e,t,o){return new(t||(t=Promise))((function(i,a){function l(n){try{s(o.next(n))}catch(n){a(n)}}function r(n){try{s(o.throw(n))}catch(n){a(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,r)}s((o=o.apply(n,e||[])).next())}))},t=function(n,e,t,o){return new(t||(t=Promise))((function(i,a){function l(n){try{s(o.next(n))}catch(n){a(n)}}function r(n){try{s(o.throw(n))}catch(n){a(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,r)}s((o=o.apply(n,e||[])).next())}))};let o,i,a;function l(n,e,t){o=n,i=e,a=t}function r(n){return Object.assign({},n)}function s(n){const e=o.some((e=>e.name===n)),t=i.some((e=>e.name===n));return e?0:t?1:-1}function c(n){const e=o.find((e=>e.name===n));if(e)return e.logoUrl;const t=i.find((e=>e.name===n));return t?t.logoUrl:""}function u(n,e,t){let o="";const i=a.find((e=>e.name===n));return o=e?0===t?i.clubOwnerURL:i.unionGuestURL:0===t?i.clubGuestURL:i.unionGuestURL,o}var d=function(n,e,t,o){return new(t||(t=Promise))((function(i,a){function l(n){try{s(o.next(n))}catch(n){a(n)}}function r(n){try{s(o.throw(n))}catch(n){a(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,r)}s((o=o.apply(n,e||[])).next())}))};function f(n,o){let i=function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"RECTANGLE"===n.type));for(const n of t){const t={x:n.x,y:n.y,name:n.name};e.push(t)}return e}();const a=n.map(((n,a)=>d(this,void 0,void 0,(function*(){const l=function(n){const e=function(n){const e={},t={},o={};for(const i in n){const a=i.toLowerCase();a.includes("owner")?e[i]=n[i]:a.includes("quest")?t[i]=n[i]:o[i]=n[i]}return Object.assign({owner:e,quest:t},o)}(n),t={title:()=>r({name:"title",textContent:e.title}),date:()=>r({name:"date",textContent:e.date}),event:()=>r({name:"event",imageUrl:(e.event,"https://firebasestorage.googleapis.com/v0/b/sportbanners-1163a.appspot.com/o/images%2FtestBanner%2FlogoMiddle.png?alt=media&token=cfd80ed7-4443-4a9b-91a4-fcce204b03dc")}),owner:()=>[r({name:"logoOwner",imageUrl:c(e.owner.logoOwner)}),r({name:"playerOwner",imageUrl:u(e.owner.playerOwner,!0,s(e.owner.logoOwner))})],quest:()=>[r({name:"logoQuest",imageUrl:c(e.quest.logoQuest)}),r({name:"playerQuest",imageUrl:u(e.quest.playerQuest,!1,s(e.quest.logoQuest))})],logoCaptionLeft:()=>r({name:"logoCaptionLeft",textContent:e.logoCaptionLeft}),logoCaptionRight:()=>r({name:"logoCaptionRight",textContent:e.logoCaptionRight})},o=[r({name:"background",imageUrl:"https://firebasestorage.googleapis.com/v0/b/sportbanners-1163a.appspot.com/o/images%2FtestBanner%2Fbackground.jpg?alt=media&token=6da34b57-e6c3-4cfc-8365-95a03848aa10"})];for(const n in e){const e=t[n];if(e){const n=e();o.push(...Array.isArray(n)?n:[n])}}return o}(n);let d=function(n,e){let t=[];for(const o of n){const n=o.name;let i=e.find((e=>e.name===n));i&&(o.imageUrl=i.imageUrl,t.push(o))}const o=e.find((n=>"title"===n.name)),i=e.find((n=>"date"===n.name)),a=e.find((n=>"logoCaptionLeft"===n.name)),l=e.find((n=>"logoCaptionRight"===n.name));return o&&t.push(o),i&&t.push(i),a&&t.push(a),l&&t.push(l),t}(i,l);yield function(n,o){return t(this,void 0,void 0,(function*(){return new Promise(((i,a)=>t(this,void 0,void 0,(function*(){const t=n.filter((n=>"title"!==n.name)),l=figma.createFrame();l.resize(1920,1080),l.x=0,l.y=o,l.name="TestBanner"+Date.now();try{const o=t.filter((n=>"string"==typeof n.imageUrl)).map((n=>{const e=n.imageUrl;return figma.createImageAsync(e)})),a=yield Promise.all(o);for(let n=0;n<a.length;n++){const e=a[n],o=t[n],i=figma.createRectangle(),{width:r,height:s}=yield e.getSizeAsync();i.resize(r,s),i.x=o.x||0,i.y=o.y||0,i.name=o.name||"",i.fills=[{type:"IMAGE",imageHash:e.hash,scaleMode:"FILL"}],l.appendChild(i)}const r={title:"title",date:"date",logoCaptionLeft:"logoCaptionLeft",logoCaptionRight:"logoCaptionRight"},s=function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"TEXT"===n.type));for(const n of t){const t=n;e.push(t.clone())}return e}(),c=function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"FRAME"===n.type));for(const n of t){const t=n;e.push(t.clone())}return e}();yield function(n){return e(this,void 0,void 0,(function*(){try{for(const e of n)yield figma.loadFontAsync(e)}catch(n){console.error("Ошибка при загрузке шрифтов:",n)}}))}(s.map((n=>n.fontName))),c.map((n=>{l.appendChild(n)})),s.map((e=>{var t;const o=r[e.name]?null===(t=n.find((n=>n.name===r[e.name])))||void 0===t?void 0:t.textContent:"";e.characters=o||"",c.find((n=>{n.name===e.name?(n.appendChild(e),n.width,n.height,e.width,e.height,e.x=(n.width-e.width)/2,e.y=(n.height-e.height)/2):l.appendChild(e)}))})),i()}catch(n){console.error(n),a(n)}}))))}))}(d,o[a])}))));Promise.all(a).then((()=>d(this,void 0,void 0,(function*(){figma.closePlugin()})))).catch((n=>{console.log(n),figma.closePlugin()}))}figma.showUI(__html__),figma.ui.onmessage=e=>{if("importCSV"===e.type){const t=function(n){let e=[];const t=n.trim().split("\n");if(0===t.length)return void console.log("File is empty");let o=t[0].split(",");o=o.map((n=>n.trim()));for(let n=1;n<t.length;n++){let i=t[n].split(","),a={};for(let n=0;n<o.length;n++){const e=o[n],t=i[n].trim();a[e]=t}e.push(a)}return e}(e.data);figma.ui.close(),function(e){const o=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/players").then((n=>n.json())),i=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/clubs").then((n=>n.json())),a=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/unions").then((n=>n.json()));Promise.all([o,i,a]).then((([e,o,i])=>{(e=>{let o=n(e.clubs),i=n(e.unions),a=function(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,t,o,i,a,l,r,s,c,u,d,f,m,g;return{id:(null===(t=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===t?void 0:t.stringValue)||"",name:(null===(i=null===(o=n.fields)||void 0===o?void 0:o.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(l=null===(a=n.fields)||void 0===a?void 0:a.logoURL)||void 0===l?void 0:l.stringValue)||"",clubGuestURL:(null===(s=null===(r=n.fields)||void 0===r?void 0:r.clubGuestURL)||void 0===s?void 0:s.stringValue)||"",clubOwnerURL:(null===(u=null===(c=n.fields)||void 0===c?void 0:c.clubOwnerURL)||void 0===u?void 0:u.stringValue)||"",unionGuestURL:(null===(f=null===(d=n.fields)||void 0===d?void 0:d.unionGuestURL)||void 0===f?void 0:f.stringValue)||"",unionOwnerURL:(null===(g=null===(m=n.fields)||void 0===m?void 0:m.unionOwnerURL)||void 0===g?void 0:g.stringValue)||""}})):[]}(e.players);if(o&&a&&i&&l(o,i,a),t){const n=(r=t.length,s=50,c=1080,Array.from({length:r},((n,e)=>(c+s)*e)));f(t,n)}var r,s,c})({players:e,clubs:o,unions:i})})).catch((n=>{console.error(n)}))}()}}})();