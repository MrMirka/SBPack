(()=>{"use strict";function n(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,t,o,i,l,a;return{id:(null===(t=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===t?void 0:t.stringValue)||"",name:(null===(i=null===(o=n.fields)||void 0===o?void 0:o.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(a=null===(l=n.fields)||void 0===l?void 0:l.logoURL)||void 0===a?void 0:a.stringValue)||""}})):[]}var e=function(n,e,t,o){return new(t||(t=Promise))((function(i,l){function a(n){try{s(o.next(n))}catch(n){l(n)}}function r(n){try{s(o.throw(n))}catch(n){l(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,r)}s((o=o.apply(n,e||[])).next())}))},t=function(n,e,t,o){return new(t||(t=Promise))((function(i,l){function a(n){try{s(o.next(n))}catch(n){l(n)}}function r(n){try{s(o.throw(n))}catch(n){l(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,r)}s((o=o.apply(n,e||[])).next())}))};let o,i,l,a;function r(n,e,t,r){o=n,i=e,l=t,a=r}function s(n){return Object.assign({},n)}function u(n){const e=o.some((e=>e.name===n)),t=i.some((e=>e.name===n));return e?0:t?1:-1}function c(n){const e=o.find((e=>e.name===n));if(e)return e.logoUrl;const t=i.find((e=>e.name===n));return t?t.logoUrl:""}function d(n,e,t){let o="";const i=l.find((e=>e.name===n));return o=e?0===t?i.clubOwnerURL:i.unionGuestURL:0===t?i.clubGuestURL:i.unionGuestURL,o}var f=function(n,e,t,o){return new(t||(t=Promise))((function(i,l){function a(n){try{s(o.next(n))}catch(n){l(n)}}function r(n){try{s(o.throw(n))}catch(n){l(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,r)}s((o=o.apply(n,e||[])).next())}))};function m(n,o){let i=function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"RECTANGLE"===n.type));for(const n of t){const t={x:n.x,y:n.y,name:n.name};e.push(t)}return e}();const l=n.map(((n,l)=>f(this,void 0,void 0,(function*(){const r=function(n){const e=function(n){const e={},t={},o={};for(const i in n){const l=i.toLowerCase();l.includes("owner")?e[i]=n[i]:l.includes("quest")?t[i]=n[i]:o[i]=n[i]}return Object.assign({owner:e,quest:t},o)}(n),t={title:()=>s({name:"title",textContent:e.title}),date:()=>s({name:"date",textContent:e.date}),eventCaption:()=>s({name:"eventCaption",textContent:e.eventCaption}),event:()=>{return s({name:"event",imageUrl:(n=e.event,a.find((e=>e.name===n)).logoUrl)});var n},owner:()=>[s({name:"logoOwner",imageUrl:c(e.owner.logoOwner)}),s({name:"playerOwner",imageUrl:d(e.owner.playerOwner,!0,u(e.owner.logoOwner))})],quest:()=>[s({name:"logoQuest",imageUrl:c(e.quest.logoQuest)}),s({name:"playerQuest",imageUrl:d(e.quest.playerQuest,!1,u(e.quest.logoQuest))})],logoCaptionLeft:()=>s({name:"logoCaptionLeft",textContent:e.logoCaptionLeft}),logoCaptionRight:()=>s({name:"logoCaptionRight",textContent:e.logoCaptionRight})},o=[];for(const n in e){const e=t[n];if(e){const n=e();o.push(...Array.isArray(n)?n:[n])}}return o}(n);let f=function(n,e){let t=[];for(const o of n){const n=o.name;let i=e.find((e=>e.name===n));i&&(o.imageUrl=i.imageUrl,t.push(o))}const o=e.find((n=>"title"===n.name)),i=e.find((n=>"date"===n.name)),l=e.find((n=>"logoCaptionLeft"===n.name)),a=e.find((n=>"logoCaptionRight"===n.name)),r=e.find((n=>"eventCaption"===n.name));return o&&t.push(o),i&&t.push(i),l&&t.push(l),a&&t.push(a),r&&t.push(r),t}(i,r);yield function(n,o){return t(this,void 0,void 0,(function*(){return new Promise(((i,l)=>t(this,void 0,void 0,(function*(){const t=n.filter((n=>"title"!==n.name)),a=figma.createFrame();a.resize(1920,1080),a.x=0,a.y=o,a.name="TestBanner"+Date.now(),function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"VECTOR"===n.type));for(const n of t){const t=n;e.push(t.clone())}return e}().map((n=>{a.appendChild(n)}));try{const o=t.filter((n=>"string"==typeof n.imageUrl)).map((n=>{const e=n.imageUrl;return figma.createImageAsync(e)})),l=yield Promise.all(o);for(let n=0;n<l.length;n++){const e=l[n],o=t[n],i=figma.createRectangle(),{width:r,height:s}=yield e.getSizeAsync();i.resize(r,s),i.x=o.x||0,i.y=o.y||0,i.name=o.name||"",i.fills=[{type:"IMAGE",imageHash:e.hash,scaleMode:"FILL"}],a.appendChild(i)}const r={title:"title",date:"date",logoCaptionLeft:"logoCaptionLeft",logoCaptionRight:"logoCaptionRight",eventCaption:"eventCaption"},s=function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"TEXT"===n.type));for(const n of t){const t=n;e.push(t.clone())}return e}(),u=function(n){let e=[];const t=figma.root.children.find((n=>"Teamplates"===n.name)).children.find((n=>"Base1"===n.name)).findAll((n=>"FRAME"===n.type));for(const n of t){const t=n;e.push(t.clone())}return e}();yield function(n){return e(this,void 0,void 0,(function*(){try{for(const e of n)yield figma.loadFontAsync(e)}catch(n){console.error("Ошибка при загрузке шрифтов:",n)}}))}(s.map((n=>n.fontName))),u.map((n=>{a.appendChild(n)})),s.map((e=>{var t;const o=r[e.name]?null===(t=n.find((n=>n.name===r[e.name])))||void 0===t?void 0:t.textContent:"";e.characters=o||"",u.find((n=>{n.name===e.name?(n.appendChild(e),e.x=(n.width-e.width)/2,e.y=(n.height-e.height)/2):a.appendChild(e)}))})),i()}catch(n){console.error(n),l(n)}}))))}))}(f,o[l])}))));Promise.all(l).then((()=>f(this,void 0,void 0,(function*(){figma.closePlugin()})))).catch((n=>{console.log(n),figma.closePlugin()}))}figma.showUI(__html__),figma.ui.onmessage=e=>{if("importCSV"===e.type){const t=function(n){let e=[];const t=n.trim().split("\n");if(0===t.length)return void console.log("File is empty");let o=t[0].split(",");o=o.map((n=>n.trim()));for(let n=1;n<t.length;n++){let i=t[n].split(","),l={};for(let n=0;n<o.length;n++){const e=o[n],t=i[n].trim();l[e]=t}e.push(l)}return e}(e.data);figma.ui.close(),function(e){const o=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/players").then((n=>n.json())),i=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/clubs").then((n=>n.json())),l=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/unions").then((n=>n.json())),a=fetch("https://firestore.googleapis.com/v1/projects/sportbanners-1163a/databases/(default)/documents/events").then((n=>n.json()));Promise.all([o,i,l,a]).then((([e,o,i,l])=>{(e=>{let o=n(e.clubs),i=n(e.unions),l=function(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,t,o,i,l,a,r,s,u,c,d,f,m,v;return{id:(null===(t=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===t?void 0:t.stringValue)||"",name:(null===(i=null===(o=n.fields)||void 0===o?void 0:o.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(a=null===(l=n.fields)||void 0===l?void 0:l.logoURL)||void 0===a?void 0:a.stringValue)||"",clubGuestURL:(null===(s=null===(r=n.fields)||void 0===r?void 0:r.clubGuestURL)||void 0===s?void 0:s.stringValue)||"",clubOwnerURL:(null===(c=null===(u=n.fields)||void 0===u?void 0:u.clubOwnerURL)||void 0===c?void 0:c.stringValue)||"",unionGuestURL:(null===(f=null===(d=n.fields)||void 0===d?void 0:d.unionGuestURL)||void 0===f?void 0:f.stringValue)||"",unionOwnerURL:(null===(v=null===(m=n.fields)||void 0===m?void 0:m.unionOwnerURL)||void 0===v?void 0:v.stringValue)||""}})):[]}(e.players),a=function(n){return n&&n.documents&&Array.isArray(n.documents)?n.documents.map((n=>{var e,t,o,i,l,a;return{id:(null===(t=null===(e=n.fields)||void 0===e?void 0:e.id)||void 0===t?void 0:t.stringValue)||"",name:(null===(i=null===(o=n.fields)||void 0===o?void 0:o.name)||void 0===i?void 0:i.stringValue)||"",logoUrl:(null===(a=null===(l=n.fields)||void 0===l?void 0:l.logoURL)||void 0===a?void 0:a.stringValue)||""}})):[]}(e.events);if(o&&l&&i&&a&&r(o,i,l,a),t){const n=(s=t.length,u=50,c=1080,Array.from({length:s},((n,e)=>(c+u)*e)));m(t,n)}var s,u,c})({players:e,clubs:o,unions:i,events:l})})).catch((n=>{console.error(n)}))}()}}})();